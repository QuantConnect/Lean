/*
 * QUANTCONNECT.COM - Democratizing Finance, Empowering Individuals.
 * Lean Algorithmic Trading Engine v2.0. Copyright 2014 QuantConnect Corporation.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
*/

using System;
using System.IO;

namespace QuantConnect.Data.UniverseSelection
{
    /// <summary>
    /// Represents a universe of futures data
    /// </summary>
    public class FutureUniverse : BaseChainUniverseData
    {
        /// <summary>
        /// Creates a new instance of the <see cref="FutureUniverse"/> class
        /// </summary>
        public FutureUniverse()
        {
        }

        /// <summary>
        /// Creates a new instance of the <see cref="FutureUniverse"/> class
        /// </summary>
        public FutureUniverse(DateTime date, Symbol symbol, string csv)
            : base(date, symbol, csv)
        {
        }

        /// <summary>
        /// Creates a new instance of the <see cref="FutureUniverse"/> class as a copy of the given instance
        /// </summary>
        public FutureUniverse(FutureUniverse other)
            : base(other)
        {
        }

        /// <summary>
        /// Reader converts each line of the data source into BaseData objects. Each data type creates its own factory method, and returns a new instance of the object
        /// each time it is called.
        /// </summary>
        /// <param name="config">Subscription data config setup object</param>
        /// <param name="stream">Stream reader of the source document</param>
        /// <param name="date">Date of the requested data</param>
        /// <param name="isLiveMode">true if we're in live mode, false for backtesting mode</param>
        /// <returns>Instance of the T:BaseData object generated by this line of the CSV</returns>
        [StubsIgnore]
        public override BaseData Reader(SubscriptionDataConfig config, StreamReader stream, DateTime date, bool isLiveMode)
        {
            if (TryRead(config, stream, date, out var symbol, out var remainingLine))
            {
                return new FutureUniverse(date, symbol, remainingLine);
            }

            return null;
        }

        /// <summary>
        /// Creates a copy of the instance
        /// </summary>
        /// <returns>Clone of the instance</returns>
        public override BaseData Clone()
        {
            return new FutureUniverse(this);
        }

        /// <summary>
        /// Gets the default resolution for this data and security type
        /// </summary>
        /// <remarks>This is a method and not a property so that python
        /// custom data types can override it</remarks>
        public override Resolution DefaultResolution()
        {
            return Resolution.Daily;
        }

        /// <summary>
        /// Implicit conversion into <see cref="Symbol"/>
        /// </summary>
        /// <param name="data">The option universe data to be converted</param>
#pragma warning disable CA2225 // Operator overloads have named alternates
        public static implicit operator Symbol(FutureUniverse data)
#pragma warning restore CA2225 // Operator overloads have named alternates
        {
            return data.Symbol;
        }

        /// <summary>
        /// Gets the CSV string representation of this universe entry
        /// </summary>
        public static string ToCsv(Symbol symbol, decimal open, decimal high, decimal low, decimal close, decimal volume, decimal? openInterest)
        {
            return $"{symbol.ID},{symbol.Value},{open},{high},{low},{close},{volume},{openInterest}";
        }

        /// <summary>
        /// Gets the CSV header string for this universe entry
        /// </summary>
        public static string CsvHeader => "symbol_id,symbol_value,open,high,low,close,volume,open_interest";
    }
}
